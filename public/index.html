<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>STOMP WebSocket í…ŒìŠ¤íŠ¸</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.5.1/sockjs.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
</head>
<body>
<h2>STOMP WebSocket í…ŒìŠ¤íŠ¸</h2>

<label>ì±„ë„ ID:</label>
<input type="text" id="channelId" value="room1">
<br><br>

<button onclick="connect()">ğŸ”— STOMP ì—°ê²°</button>
<button onclick="disconnect()">âŒ ì—°ê²° ì¢…ë£Œ</button>
<br><br>

<button onclick="subscribe()">ğŸ‘€ ì±„ë„ êµ¬ë…</button>
<button onclick="unsubscribe()">ğŸš« êµ¬ë… ì·¨ì†Œ</button>
<br><br>

<label>ë©”ì‹œì§€ ì…ë ¥:</label>
<input type="text" id="messageInput" placeholder="ë³´ë‚¼ ë©”ì‹œì§€ ì…ë ¥">
<button onclick="sendMessage()">ğŸ“© ë©”ì‹œì§€ ì „ì†¡</button>

<h3>ğŸ“© ë©”ì‹œì§€ ë¡œê·¸:</h3>
<div id="messageLog" style="border: 1px solid #ccc; padding: 10px; width: 400px; height: 200px; overflow-y: scroll;"></div>

<script>
  let stompClient = null;
  let subscription = null;

  function logMessage(message) {
      const logDiv = document.getElementById("messageLog");
      logDiv.innerHTML += `<p>${message}</p>`;
      logDiv.scrollTop = logDiv.scrollHeight; // ìë™ ìŠ¤í¬ë¡¤
  }

  function connect() {
      const socket = new SockJS("http://203.237.172.132:8080/document"); // WebSocket ì—”ë“œí¬ì¸íŠ¸
      stompClient = Stomp.over(socket);

      stompClient.connect({}, function(frame) {
          logMessage("âœ… STOMP ì—°ê²° ì„±ê³µ: " + frame);
      }, function(error) {
          logMessage("âŒ ì—°ê²° ì‹¤íŒ¨: " + error);
      });
  }

  function disconnect() {
      if (stompClient !== null) {
          stompClient.disconnect();
          logMessage("ğŸ”Œ ì—°ê²° ì¢…ë£Œ");
      }
  }

  function subscribe() {
      const channelId = document.getElementById("channelId").value;
      if (!stompClient || !stompClient.connected) {
          logMessage("ğŸš¨ ë¨¼ì € STOMPì— ì—°ê²°í•˜ì„¸ìš”!");
          return;
      }

      subscription = stompClient.subscribe(`/sub/chat/${channelId}`, function(message) {
          logMessage("ğŸ“¨ ë°›ì€ ë©”ì‹œì§€: " + message.body);
      });

      logMessage(`ğŸ‘€ /sub/chat/${channelId} êµ¬ë… ì‹œì‘`);
  }

  function unsubscribe() {
      if (subscription) {
          subscription.unsubscribe();
          logMessage("ğŸš« êµ¬ë… ì·¨ì†Œ ì™„ë£Œ");
      }
  }

  function sendMessage() {
      const channelId = document.getElementById("channelId").value;
      const message = document.getElementById("messageInput").value;

      if (!stompClient || !stompClient.connected) {
          logMessage("ğŸš¨ ë¨¼ì € STOMPì— ì—°ê²°í•˜ì„¸ìš”!");
          return;
      }

      const payload = {
          channelId: channelId,
          message: message
      };

      stompClient.send("/pub/chat/message", {}, JSON.stringify(payload));
      logMessage(`ğŸ“© ë©”ì‹œì§€ ì „ì†¡: ${JSON.stringify(payload)}`);
  }
</script>
</body>
</html>